"use strict";(self.webpackChunkvideo_front_web=self.webpackChunkvideo_front_web||[]).push([[9150],{377:(e,t,i)=>{var r=i(8338),a=i(8473),s=i(217),n=i(809),o=i(9312),d=i(1171),l=i(777),h=[d.jb,d.R_,d.k3,d.Uy,l.b4],c=new IntersectionObserver((function(e){for(var t of e)p(t)&&u(t)}),{threshold:[0,.75]});var v=()=>{document.querySelectorAll("[data-impression]").forEach((e=>{!function(e){c.observe(e)}(e)})),m()},u=e=>{var t=JSON.parse(e.target.getAttribute("data-impression"));c.unobserve(e.target),t&&((0,o.j)("publisher.impression",t),e.target.removeAttribute("data-impression"),e.target.removeAttribute("data-percentage-impression"))},m=()=>{var e={attributes:!1,childList:!0,characterData:!1,subtree:!0},t=e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{e instanceof Element&&(e.hasAttribute("data-impression")&&c.observe(e),e.querySelectorAll("[data-impression]").forEach((e=>{c.observe(e)})))}))}))},i=document.querySelectorAll(h.join(","));for(var r of i)new MutationObserver(t).observe(r,e)},p=e=>e.intersectionRatio>.75||e.intersectionRatio>0&&"0"===e.target.getAttribute("data-percentage-impression"),y=i(2033);window.sendTrackingEvent=n.sendTrackingEvent,window.addEventListener("DOMContentLoaded",(()=>{"undefined"!=typeof pa&&((0,r.Xd)()?pa.setUser((0,r.kh)()):pa.deleteUser(),window.francetv.atinternet_piano.previous_page_data=(0,s.pT)(),(0,s.l9)(),(0,n.initTrackingPianoPage)(),(0,s.N9)())})),window.addEventListener(y.w0,(()=>{v()})),(0,a.initDidomi)()},1171:(e,t,i)=>{i.d(t,{R_:()=>r,Uy:()=>a,WK:()=>o,jb:()=>n,k3:()=>s});var r=".js-section-user-watching",a=".js-section-user-video-bookmark",s=".js-section-user-program-bookmark",n=".js-reco-section",o=".js-section-similar-watched-slider"},777:(e,t,i)=>{i.d(t,{b4:()=>m,ZP:()=>y});var r=i(1054),a=i(9513),s=i(7836);var n=i(8338),o=i(8514),d=i(2875),l=i(6222),h=i(3869),c=i(1023);function v(e,t,i,r,a,s,n){try{var o=e[s](n),d=o.value}catch(e){return void i(e)}o.done?t(d):Promise.resolve(d).then(r,a)}function u(e){return function(){var t=this,i=arguments;return new Promise((function(r,a){var s=e.apply(t,i);function n(e){v(s,r,a,n,o,"next",e)}function o(e){v(s,r,a,n,o,"throw",e)}n(void 0)}))}}var m=".js-player-container",p="is-sticky";class y{constructor(){var e,t,i,r;this.playerElement=document.querySelector(m),this.metadataTargetClass="js-content-metadata",this.liveSliderTargetClass="js-section-slider",this.relatedVideosClass="js-section-related-videos",this.relatedVideosTarget=document.querySelector(".".concat(this.relatedVideosClass)),this.mediaList=new a.Z(window.FTVPlayerVideos),this.firstVideoOfPlaylist=this.mediaList.getSpecificMedia(1);var o=this.playerElement.dataset;if(this.showAd="showAd"in o,this.isLive="isLive"in o,this.canInit="canInit"in o,this.autoplay="autoplay"in o,this.withResume="withResume"in o,this.hasError="error"in o,this.showViewers="showViewers"in o,this.minViewers="minViewers"in o?o.minViewers.replace(/,/g,""):null,this.portraitModeQuery=window.matchMedia("(orientation: portrait)"),this.portraitMode=!1,this.chromecastReceiverId=null!==(e=o.chromecastReceiver)&&void 0!==e?e:null,this.hasAdCover="adCover"in o,this.notifyOnWatchtime=(0,n.b$)()?300:null,this.sendGTagEvent="sendGtagEvent"in o,this.canInit&&!(0,h.Ys)(null===(t=this.firstVideoOfPlaylist)||void 0===t?void 0:t.layerType)){this.renderPlayerWithAdBlockLayer(),addEventListener(s.Z.LIVE_ZAPPING,(e=>{var t=e.detail.name;this.refreshContentMetadata("/live-refresh-content-metadata/".concat(t,"/ajax/"))})),this.setPortraitMode(this.portraitModeQuery),void 0!==this.portraitModeQuery.addEventListener?this.portraitModeQuery.addEventListener("change",(e=>{this.setPortraitMode(e)})):void 0!==this.portraitModeQuery.addListener&&this.portraitModeQuery.addListener((e=>this.setPortraitMode(e)));var d=null!==(i=null===(r=document.querySelector(".js-nav-mobile"))||void 0===r?void 0:r.offsetHeight)&&void 0!==i?i:0;window.onscroll=()=>{!0===this.portraitMode&&this.manageScroll(d)}}else(0,h.tM)(this.firstVideoOfPlaylist.layerType)}setPortraitMode(e){this.disableSticky(),this.portraitMode=window.location.hostname.indexOf("mobile")>-1&&e.matches}manageScroll(e){window.pageYOffset>e?this.enableSticky():this.disableSticky()}enableSticky(){this.playerElement.style.removeProperty("position"),this.playerElement.classList.add(p),void 0!==this.player&&(this.player.sticky=!0)}disableSticky(){this.playerElement.classList.remove(p),this.playerElement.style.position="relative",void 0!==this.player&&(this.player.sticky=!1)}renderPlayer(){this.player=new r.Z(this.playerElement,this.showAd,this.isLive,this.withResume,this.hasError,!1,this.autoplay,!0,this.showViewers,this.minViewers,o.eY,this.chromecastReceiverId,{hasAdCover:this.hasAdCover},this.notifyOnWatchtime,this.sendGTagEvent),this.loadPlayer(this.mediaList)}addContentMetadataRefreshEventListener(){window.addEventListener(s.Z.NEXT_VIDEO,(e=>{this.refreshContentMetadata("/refresh-content-metadata/".concat(e.detail,"/")),this.refreshRelatedVideos(e.detail)}))}refreshContentMetadata(e){var t=this;return u((function*(){var i=document.querySelector(".".concat(t.metadataTargetClass));if(i){var r=yield(0,l.request)(e,{ajax:!0});if(!r.ok)return;return t.replaceDomElement(i,r.data),dispatchEvent(new CustomEvent("metadataReloaded")),window.dispatchEvent(new CustomEvent(d.mJ)),r}}))()}refreshRelatedVideos(e){var t=this;return u((function*(){var i=yield(0,l.request)("/refresh-related-videos/".concat(e,"/"));i.ok&&(t.relatedVideosTarget.innerHTML=i.data)}))()}loadPlayer(e){this.player.loadPlaylist(e),this.addContentMetadataRefreshEventListener()}replaceDomElement(e,t){if(e){var i=document.createRange().createContextualFragment(t).firstChild;e.replaceWith(i)}}renderPlayerWithAdBlockLayer(){window.magnetoscope.isAdserverReachable().then((e=>{var t;null!==(t=window.francetv.player)&&void 0!==t&&null!==(t=t.ad_block)&&void 0!==t&&t.display&&!e?((0,h.IP)(),addEventListener(c.U6,(()=>{this.handleButtonHideAdBlockClick(),window.sendTrackingEvent("click.action",{feature:"adblock",click:"passer_adblock"})}))):this.renderPlayer()})).catch((e=>{throw e}))}handleButtonHideAdBlockClick(){(0,h.iV)(),this.renderPlayer()}}}},e=>{e.O(0,[202,5407,8338,2217],(()=>{return t=377,e(e.s=t);var t}));e.O()}]);